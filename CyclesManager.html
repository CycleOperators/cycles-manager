<!DOCTYPE html>
<html><head title="Doc"><meta charset="UTF-8"/><link href="styles.css" rel="stylesheet"/></head><body><nav class="sidebar"><h3>Modules</h3><ul><li><li><a href="CyclesManager.html">CyclesManager</a></li></li><li><li><a href="CyclesRequester.html">CyclesRequester</a></li></li><li><li><a href="InterfaceSpec.html">InterfaceSpec</a></li></li><li><li><a href="Internal.html">Internal</a></li></li><li><li><a href="SendCycles.html">SendCycles</a></li></li></ul><h3>Declarations</h3><ul><li><li><a href="#type.TransferCyclesResult">TransferCyclesResult</a></li></li><li><li><a href="#type.TransferCyclesError">TransferCyclesError</a></li></li><li><li><a href="#type.Interface">Interface</a></li></li><li><li><a href="#type.RateQuota">RateQuota</a></li></li><li><li><a href="#type.CanisterQuota">CanisterQuota</a></li></li><li><li><a href="#type.AggregateQuota">AggregateQuota</a></li></li><li><li><a href="#type.DefaultChildCanisterCyclesSettings">DefaultChildCanisterCyclesSettings</a></li></li><li><li><a href="#type.AggregateCyclesSettings">AggregateCyclesSettings</a></li></li><li><li><a href="#type.CanisterCyclesSettings">CanisterCyclesSettings</a></li></li><li><li><a href="#type.ChildCanisterMap">ChildCanisterMap</a></li></li><li><li><a href="#type.CyclesManager">CyclesManager</a></li></li><li><li><a href="#init">init</a></li></li><li><li><a href="#addChildCanister">addChildCanister</a></li></li><li><li><a href="#removeChildCanister">removeChildCanister</a></li></li><li><li><a href="#setMinCyclesPerTopup">setMinCyclesPerTopup</a></li></li><li><li><a href="#setDefaultCanisterCyclesQuota">setDefaultCanisterCyclesQuota</a></li></li><li><li><a href="#setAggregateCyclesQuota">setAggregateCyclesQuota</a></li></li><li><li><a href="#transferCycles">transferCycles</a></li></li><li><li><a href="#toText">toText</a></li></li><li><li><a href="#internal_DO_NOT_USE_TransferCycles">internal_DO_NOT_USE_TransferCycles</a></li></li></ul></nav><div class="documentation"><h1>CyclesManager</h1><p>A library meant to allow a single canister to act as a cycles battery for receiving requests from and topping up child canisters</p>
<div class="declaration"><h4 class="type-declaration" id="type.TransferCyclesResult"><span class="keyword">type </span><span class="type">TransferCyclesResult</span> = <span class="type">Result.Result</span>&lt;<span class="type">Nat</span>, <a href="#type.TransferCyclesError"><span class="type">TransferCyclesError</span></a>&gt;</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="type.TransferCyclesError"><span class="keyword">type </span><span class="type">TransferCyclesError</span> = {#insufficient_cycles_available; #too_few_cycles_requested; #aggregate_quota_reached; #canister_quota_reached; #other : <span class="type">Text</span>}</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="type.Interface"><span class="keyword">type </span><span class="type">Interface</span> = <span class="keyword">actor </span>{ cycles_manager_transferCycles : <span class="keyword">shared </span>(<span class="type">Nat</span>) -&gt; <span class="keyword">async </span><a href="#type.TransferCyclesResult"><span class="type">TransferCyclesResult</span></a> }</h4><p><p>Interface that must be implemented by the &quot;battery&quot; canister in order for this library to work</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.RateQuota"><span class="keyword">type </span><span class="type">RateQuota</span> = { maxAmount : <span class="type">Nat</span>; durationInSeconds : <span class="type">Nat</span> }</h4><p><p>A quota for the maximum amount of cycles that can be spent during the specified duration</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.CanisterQuota"><span class="keyword">type </span><span class="type">CanisterQuota</span> = {#fixedAmount : <span class="type">Nat</span>; #maxAmount : <span class="type">Nat</span>; #rate : <a href="#type.RateQuota"><span class="type">RateQuota</span></a>; #unlimited}</h4><p><p>Quota types for individual canisters</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.AggregateQuota"><span class="keyword">type </span><span class="type">AggregateQuota</span> = {#rate : <a href="#type.RateQuota"><span class="type">RateQuota</span></a>; #unlimited}</h4><p><p>Quota types specified by the &quot;Battery Canister&quot; in which the Cycles Manager resides</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.DefaultChildCanisterCyclesSettings"><span class="keyword">type </span><span class="type">DefaultChildCanisterCyclesSettings</span> = { quota : <a href="#type.CanisterQuota"><span class="type">CanisterQuota</span></a> }</h4><p><p>Default canister cycles settings that by default apply to all &quot;child&quot; canisters in the canisterToCyclesSettingsMap 
These are overwritten by a canister specific cycles settings</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.AggregateCyclesSettings"><span class="keyword">type </span><span class="type">AggregateCyclesSettings</span> = { quota : <a href="#type.AggregateQuota"><span class="type">AggregateQuota</span></a> }</h4><p><p>Aggregate settings that applies to the cumulative cycles usage of all canisters</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.CanisterCyclesSettings"><span class="keyword">type </span><span class="type">CanisterCyclesSettings</span> = { quota : ?<a href="#type.CanisterQuota"><span class="type">CanisterQuota</span></a> }</h4><p><p>Single Canister specific cycles settings
These overwrite the default child canister cycles settings</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.ChildCanisterMap"><span class="keyword">type </span><span class="type">ChildCanisterMap</span> = <span class="type">BTree.BTree</span>&lt;<span class="type">Principal</span>, <a href="Internal.html#type.InternalCanisterCyclesSettings"><span class="type">Internal.InternalCanisterCyclesSettings</span></a>&gt;</h4><p><p>Max # of cycles that can be requested by a canister per topup request
A mapping of canister principals to their cycles settings</p>
</p></div><div class="declaration"><h4 class="type-declaration" id="type.CyclesManager"><span class="keyword">type </span><span class="type">CyclesManager</span> = { defaultSettings : <a href="Internal.html#type.InternalDefaultChildCanisterCyclesSettings"><span class="type">Internal.InternalDefaultChildCanisterCyclesSettings</span></a>; aggregateSettings : <a href="Internal.html#type.InternalAggregateCyclesSettings"><span class="type">Internal.InternalAggregateCyclesSettings</span></a>; childCanisterMap : <a href="#type.ChildCanisterMap"><span class="type">ChildCanisterMap</span></a>; <span class="keyword">var </span>minCyclesPerTopup : ?<span class="type">Nat</span> }</h4><p><p>A type representing cycles management where the Index/Factory cansiter is responsible for
fielding requests from canisters and determining whether or not to top them up</p>
<p>Cycles Quota Priority</p>
<ol><li>Aggregate Quota Cycles Setting - if a rate aggregate quota exists and it has been hit, then no more cycles will be funded from
 this cycles manager for the rest of the period</li><li>Individual canister Cycles Quota Setting </li><li>Default Cycles Quota Settings - If a canister exists in the childCanisterMap, but no quota setting is provided for that canister,
 use the default (default) cycles quota setting</li></ol>

<p>If no individual or default quota is provided, the request for cycles is denied.
Also, if the individual canister does not exist in the childCanisterMap, it's request for cycles will be denied (access control)</p>
</p></div><div class="declaration"><h4 class="function" id="init"><code><span class="keyword">public func </span><span class="fnname">init</span>() : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a></code></h4><p><p>Initializes a CyclesManager</p>
</p></div><div class="declaration"><h4 class="function" id="addChildCanister"><code><span class="keyword">public func </span><span class="fnname">addChildCanister</span>(<br/>  <span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>, <br/>  <span class="parameter">canister</span> : <span class="type">Principal</span>, <br/>  <span class="parameter">cyclesSettings</span> : <a href="#type.CanisterCyclesSettings"><span class="type">CanisterCyclesSettings</span></a><br/>) : ()</code></h4><p><p>Adds a child canister to the CyclesManager</p>
</p></div><div class="declaration"><h4 class="function" id="removeChildCanister"><code><span class="keyword">public func </span><span class="fnname">removeChildCanister</span>(<span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>, <span class="parameter">canister</span> : <span class="type">Principal</span>) : ()</code></h4><p><p>Removes a child canister from the CyclesManager</p>
</p></div><div class="declaration"><h4 class="function" id="setMinCyclesPerTopup"><code><span class="keyword">public func </span><span class="fnname">setMinCyclesPerTopup</span>(<span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>, <span class="parameter">minCyclesPerTopup</span> : <span class="type">Nat</span>) : ()</code></h4><p><p>Sets the minimum number of cycles that a canister can request per topup</p>
</p></div><div class="declaration"><h4 class="function" id="setDefaultCanisterCyclesQuota"><code><span class="keyword">public func </span><span class="fnname">setDefaultCanisterCyclesQuota</span>(<span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>, <span class="parameter">quota</span> : <a href="#type.CanisterQuota"><span class="type">CanisterQuota</span></a>) : ()</code></h4><p><p>Sets the default canister cycles quota</p>
</p></div><div class="declaration"><h4 class="function" id="setAggregateCyclesQuota"><code><span class="keyword">public func </span><span class="fnname">setAggregateCyclesQuota</span>(<span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>, <span class="parameter">quota</span> : <a href="#type.AggregateQuota"><span class="type">AggregateQuota</span></a>) : ()</code></h4><p><p>Sets the aggregate canister cycles quota</p>
</p></div><div class="declaration"><h4 class="function" id="transferCycles"><code><span class="keyword">public func </span><span class="fnname">transferCycles</span>() : <span class="keyword">async* </span><a href="#type.TransferCyclesResult"><span class="type">TransferCyclesResult</span></a></code></h4><p><p>Attempts to transfers cycles to a canister principal</p>
</p></div><div class="declaration"><h4 class="function" id="toText"><code><span class="keyword">public func </span><span class="fnname">toText</span>(<span class="parameter">cyclesManager</span> : <a href="#type.CyclesManager"><span class="type">CyclesManager</span></a>) : <span class="type">Text</span></code></h4><p></p></div><div class="declaration"><h4 class="function" id="internal_DO_NOT_USE_TransferCycles"><code><span class="keyword">public func </span><span class="fnname">internal_DO_NOT_USE_TransferCycles</span>() : <span class="keyword">async* </span><a href="#type.TransferCyclesResult"><span class="type">TransferCyclesResult</span></a></code></h4><p><p>@deprecated - this is an internal function whose only purpose is to allow async unit testing. Do not use directly!</p>
</p></div></div></body></html>